<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RESET Tracker – with Routine Capture</title>
  <!--
    =============================================================
    2025‑04‑26  ·  RESET Coaching internal prototype
    ▸ Adds a light‑weight "Routine Capture" layer so parents / students
      log their *default* study slot, workspace, and phone‑parking spot
      *before* nightly task‑planning begins.
    ▸ Persists per‑client in localStorage → allData[client].routine {…}
      { startTime, workspace, phoneHome }
    ▸ UI additions:
         •  “Routine” button in the top controls bar
         •  Modal for viewing / editing routine
         •  Inline display chip under Client Info once set
  -->
  <style>
    /*  ⤵ existing palette & resets trimmed for brevity  */
    :root{
      --bg-main:#F4F7FC;--bg-card:#FFF;--border-color:#E2E8F0;--text-primary:#2D3748;--text-secondary:#4A5568;--text-light:#718096;--primary-blue:#4A90E2;--primary-blue-dark:#357ABD;--success-green:#48BB78;--radius:6px;--shadow-sm:0 1px 3px rgba(0,0,0,.06);--spacing-unit:1rem;
    }
    *{box-sizing:border-box}
    body{margin:0 auto;max-width:860px;padding:var(--spacing-unit);font-family:sans-serif;background:var(--bg-main);color:var(--text-primary);line-height:1.4}
    h1{margin:1rem 0 .5rem;font-size:1.75rem;font-weight:600}
    /* buttons / modal / table ‑‑ (unchanged styles collapsed) */
    .btn{display:inline-block;padding:.45em .8em;margin:.25em .25em 0 0;border:1px solid var(--border-color);border-radius:var(--radius);background:#fff;font-size:.95em;cursor:pointer}
    .btn-primary{background:var(--primary-blue);border-color:var(--primary-blue);color:#fff}
    .btn-primary:hover{background:var(--primary-blue-dark)}
    /* simple chip */
    .chip{display:inline-block;background:#EDF2F7;color:var(--text-secondary);padding:.15rem .55rem;border-radius:12px;font-size:.8em;margin-right:.4rem}
    /* generic modal shell (shared) */
    .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);z-index:1000;overflow-y:auto}
    .modal-content{background:var(--bg-card);margin:2rem auto;padding:1.25rem;max-width:540px;border-radius:var(--radius);border:1px solid var(--border-color);box-shadow:var(--shadow-sm);position:relative}
    .modal-close{position:absolute;top:.4rem;right:.4rem;background:#E53E3E;color:#fff;border:none;border-radius:4px;padding:.25rem .55rem;font-weight:bold;cursor:pointer}
  </style>
</head>
<body>
<h1>RESET Tracker <small style="font-size:.6em;color:var(--text-light)">prototype</small></h1>

<!--‑‑ TOP CONTROLS ‑‑-->
<div class="controls" style="display:flex;flex-wrap:wrap;gap:.6rem;margin:.9rem 0">  
  <div><label>Client:</label><select id="clientSelect"></select><button class="btn" id="addClientBtn">+ Client</button></div>
  <div><label>Date:</label><input type="date" id="datePicker"/></div>
  <button class="btn" id="routineBtn">Routine</button>
  <button class="btn" id="multiDayBtn">Multi‑Day</button>
  <button class="btn" id="weeklyBtn">Weekly</button>
  <button class="btn" id="exportBtn">Export</button>
</div>

<!--‑‑ CLIENT INFO & ROUTINE CHIP  ‑‑-->
<div id="clientInfoCard" style="background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius);padding:.8rem;margin-bottom:1rem">
  <div id="bigGoalLine"></div>
  <div id="routineLine" style="margin-top:.35rem"></div>
</div>

<!-- (✂)  =====  TASK‑PLANNING UI unchanged – omitted for brevity ===== -->

<!--‑‑ ROUTINE MODAL  ‑‑-->
<div id="routineModal" class="modal-overlay">
  <div class="modal-content">
    <button class="modal-close" data-close="routineModal">X</button>
    <h2 style="margin-top:0">Default Study Routine</h2>
    <p style="color:var(--text-secondary);font-size:.9em;margin-bottom:1rem">These defaults auto‑fill when you plan each day.</p>

    <label style="font-weight:600">Typical homework <em>start</em> time:</label><br/>
    <select id="routineStartSelect" style="margin:.25rem 0 1rem 0"></select><br/>

    <label style="font-weight:600">Primary workspace (desk / room):</label><br/>
    <input type="text" id="routineWorkspace" style="width:100%;margin:.25rem 0 1rem 0" placeholder="e.g. Kitchen table"/>

    <label style="font-weight:600">Phone parks here:</label><br/>
    <input type="text" id="routinePhone" style="width:100%;margin:.25rem 0 1.2rem 0" placeholder="e.g. Charging station in hallway"/>

    <button class="btn btn-primary" id="saveRoutineBtn">Save Routine</button>
    <button class="btn" data-close="routineModal">Cancel</button>
  </div>
</div>

<script>
/* ===============================================================
   This JS is **pruned to only show the new Routine‑specific pieces**
   ▸ The original tracker logic (tasks, weekly, images, etc.) remains
     unchanged – insert your existing code below these new blocks.
   ===============================================================*/

const STORAGE_KEY = "resetTracker_v3";
let allData = {};
let currentClient = null;
let currentDate = null;

// === Quick helpers ===
function buildTimeOptions(sel){
  sel.innerHTML="";
  for(let h=14;h<=22;h++){ // 2 pm – 10 pm typical window
    for(let m of [0,30]){
      const d=new Date();d.setHours(h,m);
      const lab=d.toLocaleTimeString([], {hour:'numeric',minute:'2-digit'});
      const o=document.createElement('option');o.value=lab;o.textContent=lab;sel.appendChild(o);
    }
  }
}
function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(allData)); }
function load(){ try{allData=JSON.parse(localStorage.getItem(STORAGE_KEY)||"{}");}catch(e){allData={};}}

// === DOM ===
const clientSelect=document.getElementById('clientSelect');
const routineBtn=document.getElementById('routineBtn');
const routineModal=document.getElementById('routineModal');
const routineStartSelect=document.getElementById('routineStartSelect');
const routineWorkspace=document.getElementById('routineWorkspace');
const routinePhone=document.getElementById('routinePhone');
const saveRoutineBtn=document.getElementById('saveRoutineBtn');
const routineLine=document.getElementById('routineLine');

buildTimeOptions(routineStartSelect);

// === bootstrap ===
load();
if(Object.keys(allData).length===0){allData["Sample"]={routine:{},daily:{}};}
clientSelect.innerHTML=Object.keys(allData).map(c=>`<option>${c}</option>`).join('');
currentClient=clientSelect.value;
renderRoutineChip();

// === events ===
clientSelect.addEventListener('change',()=>{currentClient=clientSelect.value;renderRoutineChip();});

routineBtn.addEventListener('click',()=>{
  const r=allData[currentClient].routine||{};
  routineStartSelect.value=r.startTime||routineStartSelect.options[0].value;
  routineWorkspace.value=r.workspace||"";
  routinePhone.value=r.phoneHome||"";
  routineModal.style.display='block';
});

document.querySelectorAll('[data-close="routineModal"], .modal-close').forEach(btn=>btn.addEventListener('click',()=>routineModal.style.display='none'));

saveRoutineBtn.addEventListener('click',()=>{
  allData[currentClient].routine={
    startTime:routineStartSelect.value,
    workspace:routineWorkspace.value.trim(),
    phoneHome:routinePhone.value.trim()
  };
  save();
  routineModal.style.display='none';
  renderRoutineChip();
});

function renderRoutineChip(){
  if(!currentClient) return;
  const r=allData[currentClient].routine||{};
  routineLine.innerHTML="";
  if(r.startTime||r.workspace||r.phoneHome){
    if(r.startTime) routineLine.innerHTML+=`<span class='chip'>Start ⇢ ${r.startTime}</span>`;
    if(r.workspace) routineLine.innerHTML+=`<span class='chip'>Place ⇢ ${escapeHtml(r.workspace)}</span>`;
    if(r.phoneHome) routineLine.innerHTML+=`<span class='chip'>Phone ⇢ ${escapeHtml(r.phoneHome)}</span>`;
  } else {
    routineLine.innerHTML="<span style='color:var(--text-light);font-size:.9em'>(No routine set yet)</span>";
  }
}
function escapeHtml(str){return str.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}
</script>

<!-- 🔹 Insert rest of original tracker JS here (tasks, weekly planner, etc.). -->
</body>
</html>
